<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Module: SymetrieCom::Acts::NestedSet::InstanceMethods</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Module</strong></td>
          <td class="class-name-in-header">SymetrieCom::Acts::NestedSet::InstanceMethods</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../../files/lib/better_nested_set_rb.html">
                lib/better_nested_set.rb
                </a>
        <br />
            </td>
        </tr>

        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This module provides instance methods for an enhanced acts_as_nested_set
mixin. Please see the README for background information, examples, and tips
on usage.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000019">&lt;=&gt;</a>&nbsp;&nbsp;
      <a href="#M000067">add_child</a>&nbsp;&nbsp;
      <a href="#M000051">all_children</a>&nbsp;&nbsp;
      <a href="#M000043">all_children_count</a>&nbsp;&nbsp;
      <a href="#M000060">all_children_through</a>&nbsp;&nbsp;
      <a href="#M000026">ancestors</a>&nbsp;&nbsp;
      <a href="#M000058">ancestors_and_self_through</a>&nbsp;&nbsp;
      <a href="#M000059">ancestors_through</a>&nbsp;&nbsp;
      <a href="#M000080">calculate_reorder_steps</a>&nbsp;&nbsp;
      <a href="#M000065">check_full_tree</a>&nbsp;&nbsp;
      <a href="#M000064">check_subtree</a>&nbsp;&nbsp;
      <a href="#M000021">child?</a>&nbsp;&nbsp;
      <a href="#M000045">child_by_id</a>&nbsp;&nbsp;
      <a href="#M000049">child_of?</a>&nbsp;&nbsp;
      <a href="#M000053">children</a>&nbsp;&nbsp;
      <a href="#M000054">children?</a>&nbsp;&nbsp;
      <a href="#M000046">children_by_id</a>&nbsp;&nbsp;
      <a href="#M000052">children_count</a>&nbsp;&nbsp;
      <a href="#M000018">destroy_descendants</a>&nbsp;&nbsp;
      <a href="#M000047">direct_child_by_id</a>&nbsp;&nbsp;
      <a href="#M000050">direct_child_of?</a>&nbsp;&nbsp;
      <a href="#M000055">direct_children</a>&nbsp;&nbsp;
      <a href="#M000048">direct_children_by_id</a>&nbsp;&nbsp;
      <a href="#M000033">first?</a>&nbsp;&nbsp;
      <a href="#M000031">first_sibling</a>&nbsp;&nbsp;
      <a href="#M000032">first_sibling?</a>&nbsp;&nbsp;
      <a href="#M000044">full_set</a>&nbsp;&nbsp;
      <a href="#M000061">full_set_through</a>&nbsp;&nbsp;
      <a href="#M000038">higher_item</a>&nbsp;&nbsp;
      <a href="#M000068">insert_at</a>&nbsp;&nbsp;
      <a href="#M000036">last?</a>&nbsp;&nbsp;
      <a href="#M000034">last_sibling</a>&nbsp;&nbsp;
      <a href="#M000035">last_sibling?</a>&nbsp;&nbsp;
      <a href="#M000056">leaves</a>&nbsp;&nbsp;
      <a href="#M000057">leaves_count</a>&nbsp;&nbsp;
      <a href="#M000042">level</a>&nbsp;&nbsp;
      <a href="#M000040">lower_item</a>&nbsp;&nbsp;
      <a href="#M000074">move_higher</a>&nbsp;&nbsp;
      <a href="#M000073">move_lower</a>&nbsp;&nbsp;
      <a href="#M000076">move_to_bottom</a>&nbsp;&nbsp;
      <a href="#M000071">move_to_child_of</a>&nbsp;&nbsp;
      <a href="#M000069">move_to_left_of</a>&nbsp;&nbsp;
      <a href="#M000072">move_to_position</a>&nbsp;&nbsp;
      <a href="#M000070">move_to_right_of</a>&nbsp;&nbsp;
      <a href="#M000075">move_to_top</a>&nbsp;&nbsp;
      <a href="#M000039">next_sibling</a>&nbsp;&nbsp;
      <a href="#M000030">next_siblings</a>&nbsp;&nbsp;
      <a href="#M000025">parent</a>&nbsp;&nbsp;
      <a href="#M000079">perform_reorder_of_children</a>&nbsp;&nbsp;
      <a href="#M000037">previous_sibling</a>&nbsp;&nbsp;
      <a href="#M000029">previous_siblings</a>&nbsp;&nbsp;
      <a href="#M000066">renumber_full_tree</a>&nbsp;&nbsp;
      <a href="#M000078">reorder_children</a>&nbsp;&nbsp;
      <a href="#M000023">root</a>&nbsp;&nbsp;
      <a href="#M000020">root?</a>&nbsp;&nbsp;
      <a href="#M000024">roots</a>&nbsp;&nbsp;
      <a href="#M000027">self_and_ancestors</a>&nbsp;&nbsp;
      <a href="#M000041">self_and_siblings</a>&nbsp;&nbsp;
      <a href="#M000062">self_and_siblings_through</a>&nbsp;&nbsp;
      <a href="#M000017">set_left_right</a>&nbsp;&nbsp;
      <a href="#M000016">sibling_condition</a>&nbsp;&nbsp;
      <a href="#M000028">siblings</a>&nbsp;&nbsp;
      <a href="#M000063">siblings_through</a>&nbsp;&nbsp;
      <a href="#M000077">swap</a>&nbsp;&nbsp;
      <a href="#M000022">unknown?</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000019" class="method-detail">
        <a name="M000019"></a>

        <div class="method-heading">
          <a href="#M000019" class="method-signature">
          <span class="method-name">&lt;=&gt;</span><span class="method-args">(x)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
By default, records are compared and sorted using the left column.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000019-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000019-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 451</span>
451:         <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;=&gt;</span>(<span class="ruby-identifier">x</span>)
452:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&lt;=&gt;</span> <span class="ruby-identifier">x</span>[<span class="ruby-identifier">left_col_name</span>]
453:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000067" class="method-detail">
        <a name="M000067"></a>

        <div class="method-heading">
          <a href="#M000067" class="method-signature">
          <span class="method-name">add_child</span><span class="method-args">(child)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deprecated. Adds a child to this object in the tree. If this object
hasn&#8216;t been initialized, it gets set up as a <a
href="InstanceMethods.html#M000023">root</a> node.
</p>
<p>
This method exists only for compatibility and will be removed in future
versions.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000067-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000067-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 755</span>
755:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_child</span>(<span class="ruby-identifier">child</span>)
756:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
757:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>; <span class="ruby-identifier">child</span>.<span class="ruby-identifier">reload</span> <span class="ruby-comment cmt"># for compatibility with old version</span>
758:             <span class="ruby-comment cmt"># the old version allows records with nil values for lft and rgt</span>
759:             <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>]
760:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">child</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">child</span>[<span class="ruby-identifier">right_col_name</span>]
761:                 <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecordError</span>, <span class="ruby-value str">&quot;If parent lft or rgt are nil, you can't add a child with non-nil lft or rgt&quot;</span>
762:               <span class="ruby-keyword kw">end</span>
763:               <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{left_col_name} = CASE \
764:                                           WHEN id = #{self.id} \
765:                                             THEN 1 \
766:                                           WHEN id = #{child.id} \
767:                                             THEN 3 \
768:                                           ELSE #{left_col_name} END, \
769:                                      #{right_col_name} = CASE \
770:                                           WHEN id = #{self.id} \
771:                                             THEN 2 \
772:                                           WHEN id = #{child.id} \
773:                                             THEN 4 \
774:                                          ELSE #{right_col_name} END&quot;</span>,
775:                                       <span class="ruby-identifier">scope_condition</span>)
776:               <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>; <span class="ruby-identifier">child</span>.<span class="ruby-identifier">reload</span>
777:             <span class="ruby-keyword kw">end</span>
778:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">child</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">child</span>[<span class="ruby-identifier">right_col_name</span>]
779:               <span class="ruby-identifier">maxright</span> = <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">right_col_name</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope_condition</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
780:               <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{left_col_name} = CASE \
781:                                           WHEN id = #{child.id} \
782:                                             THEN #{maxright + 1} \
783:                                           ELSE #{left_col_name} END, \
784:                                       #{right_col_name} = CASE \
785:                                           WHEN id = #{child.id} \
786:                                             THEN #{maxright + 2} \
787:                                           ELSE #{right_col_name} END&quot;</span>,
788:                                       <span class="ruby-identifier">scope_condition</span>)
789:               <span class="ruby-identifier">child</span>.<span class="ruby-identifier">reload</span>
790:             <span class="ruby-keyword kw">end</span>
791:             
792:             <span class="ruby-identifier">child</span>.<span class="ruby-identifier">move_to_child_of</span>(<span class="ruby-keyword kw">self</span>)
793:             <span class="ruby-comment cmt"># self.reload ## even though move_to calls target.reload, at least one object in the tests was not reloading (near the end of test_common_usage)</span>
794:           <span class="ruby-keyword kw">end</span>
795:         <span class="ruby-comment cmt"># self.reload</span>
796:         <span class="ruby-comment cmt"># child.reload</span>
797:         <span class="ruby-comment cmt">#</span>
798:         <span class="ruby-comment cmt"># if child.root?</span>
799:         <span class="ruby-comment cmt">#   raise ActiveRecord::ActiveRecordError, &quot;Adding sub-tree isn\'t currently supported&quot;</span>
800:         <span class="ruby-comment cmt"># else</span>
801:         <span class="ruby-comment cmt">#   if ( (self[left_col_name] == nil) || (self[right_col_name] == nil) )</span>
802:         <span class="ruby-comment cmt">#     # Looks like we're now the root node!  Woo</span>
803:         <span class="ruby-comment cmt">#     self[left_col_name] = 1</span>
804:         <span class="ruby-comment cmt">#     self[right_col_name] = 4</span>
805:         <span class="ruby-comment cmt">#     </span>
806:         <span class="ruby-comment cmt">#     # What do to do about validation?</span>
807:         <span class="ruby-comment cmt">#     return nil unless self.save</span>
808:         <span class="ruby-comment cmt">#     </span>
809:         <span class="ruby-comment cmt">#     child[parent_col_name] = self.id</span>
810:         <span class="ruby-comment cmt">#     child[left_col_name] = 2</span>
811:         <span class="ruby-comment cmt">#     child[right_col_name]= 3</span>
812:         <span class="ruby-comment cmt">#     return child.save</span>
813:         <span class="ruby-comment cmt">#   else</span>
814:         <span class="ruby-comment cmt">#     # OK, we need to add and shift everything else to the right</span>
815:         <span class="ruby-comment cmt">#     child[parent_col_name] = self.id</span>
816:         <span class="ruby-comment cmt">#     right_bound = self[right_col_name]</span>
817:         <span class="ruby-comment cmt">#     child[left_col_name] = right_bound</span>
818:         <span class="ruby-comment cmt">#     child[right_col_name] = right_bound + 1</span>
819:         <span class="ruby-comment cmt">#     self[right_col_name] += 2</span>
820:         <span class="ruby-comment cmt">#     self.class.transaction {</span>
821:         <span class="ruby-comment cmt">#       self.class.update_all( &quot;#{left_col_name} = (#{left_col_name} + 2)&quot;,  &quot;#{scope_condition} AND #{left_col_name} &gt;= #{right_bound}&quot; )</span>
822:         <span class="ruby-comment cmt">#       self.class.update_all( &quot;#{right_col_name} = (#{right_col_name} + 2)&quot;,  &quot;#{scope_condition} AND #{right_col_name} &gt;= #{right_bound}&quot; )</span>
823:         <span class="ruby-comment cmt">#       self.save</span>
824:         <span class="ruby-comment cmt">#       child.save</span>
825:         <span class="ruby-comment cmt">#     }</span>
826:         <span class="ruby-comment cmt">#   end</span>
827:         <span class="ruby-comment cmt"># end</span>
828:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000051" class="method-detail">
        <a name="M000051"></a>

        <div class="method-heading">
          <a href="#M000051" class="method-signature">
          <span class="method-name">all_children</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all <a href="InstanceMethods.html#M000053">children</a> and nested
<a href="InstanceMethods.html#M000053">children</a>. Pass :exclude =&gt;
item, or id, or [items or id] to exclude one or more items <b>and</b> all
of their descendants.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000051-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000051-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 635</span>
635:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_children</span>(<span class="ruby-identifier">scope</span> = {})
636:           <span class="ruby-identifier">full_set</span>(<span class="ruby-identifier">scope</span>) <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
637:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000043" class="method-detail">
        <a name="M000043"></a>

        <div class="method-heading">
          <a href="#M000043" class="method-signature">
          <span class="method-name">all_children_count</span><span class="method-args">(scope = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the number of nested <a
href="InstanceMethods.html#M000053">children</a> of this object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000043-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000043-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 568</span>
568:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_children_count</span>(<span class="ruby-identifier">scope</span> = <span class="ruby-keyword kw">nil</span>)
569:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">all_children</span>(<span class="ruby-identifier">scope</span>).<span class="ruby-identifier">length</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>)
570:           <span class="ruby-keyword kw">return</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)<span class="ruby-operator">/</span><span class="ruby-value">2</span>
571:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000060" class="method-detail">
        <a name="M000060"></a>

        <div class="method-heading">
          <a href="#M000060" class="method-signature">
          <span class="method-name">all_children_through</span><span class="method-args">(other, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
All <a href="InstanceMethods.html#M000053">children</a> until the other is
reached - excluding self
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000060-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000060-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 680</span>
680:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">all_children_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span> = {})
681:           <span class="ruby-identifier">full_set_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span>) <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
682:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000026" class="method-detail">
        <a name="M000026"></a>

        <div class="method-heading">
          <a href="#M000026" class="method-signature">
          <span class="method-name">ancestors</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of all parents, starting with the <a
href="InstanceMethods.html#M000023">root</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000026-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000026-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 490</span>
490:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ancestors</span>(<span class="ruby-identifier">scope</span> = {})
491:           <span class="ruby-identifier">self_and_ancestors</span>(<span class="ruby-identifier">scope</span>) <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
492:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000058" class="method-detail">
        <a name="M000058"></a>

        <div class="method-heading">
          <a href="#M000058" class="method-signature">
          <span class="method-name">ancestors_and_self_through</span><span class="method-args">(other, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
All nodes between two nodes, those nodes included in effect all <a
href="InstanceMethods.html#M000026">ancestors</a> until the other is
reached
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000058-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000058-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 668</span>
668:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ancestors_and_self_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span> = {})
669:           <span class="ruby-identifier">first</span>, <span class="ruby-identifier">last</span> = [<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">other</span>].<span class="ruby-identifier">sort</span>
670:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{last[left_col_name]} BETWEEN #{prefixed_left_col_name} AND #{prefixed_right_col_name}) AND #{prefixed_left_col_name} &gt;= #{first[left_col_name]}&quot;</span>, 
671:             <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
672:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000059" class="method-detail">
        <a name="M000059"></a>

        <div class="method-heading">
          <a href="#M000059" class="method-signature">
          <span class="method-name">ancestors_through</span><span class="method-args">(other, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Ancestors until the other is reached - excluding self
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000059-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000059-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 675</span>
675:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ancestors_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span> = {})
676:           <span class="ruby-identifier">ancestors_and_self_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span>) <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
677:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000065" class="method-detail">
        <a name="M000065"></a>

        <div class="method-heading">
          <a href="#M000065" class="method-signature">
          <span class="method-name">check_full_tree</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks the left/right indexes of the entire tree that this node belongs to,
returning the number of records checked. Throws
ActiveRecord::ActiveRecordError if it finds a problem. This method is
needed because <a href="InstanceMethods.html#M000064">check_subtree</a>
alone cannot find gaps between virtual <a
href="InstanceMethods.html#M000024">roots</a>, orphaned nodes or endless
loops.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000065-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000065-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 718</span>
718:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_full_tree</span>
719:           <span class="ruby-identifier">total_nodes</span> = <span class="ruby-value">0</span>
720:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
721:             <span class="ruby-comment cmt"># virtual roots make this method more complex than it otherwise would be</span>
722:             <span class="ruby-identifier">n</span> = <span class="ruby-value">1</span>
723:             <span class="ruby-identifier">roots</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span> 
724:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecordError</span>, <span class="ruby-node">&quot;Gaps between roots in the tree containing record ##{r.id}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">!=</span> <span class="ruby-identifier">n</span>
725:               <span class="ruby-identifier">r</span>.<span class="ruby-identifier">check_subtree</span>
726:               <span class="ruby-identifier">n</span> = <span class="ruby-identifier">r</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
727:             <span class="ruby-keyword kw">end</span>
728:             <span class="ruby-identifier">total_nodes</span> = <span class="ruby-identifier">roots</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-value">0</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">sum</span>, <span class="ruby-identifier">r</span><span class="ruby-operator">|</span> <span class="ruby-identifier">sum</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">all_children_count</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> }
729:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition}&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">total_nodes</span>
730:               <span class="ruby-identifier">raise</span> <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">ActiveRecordError</span>, <span class="ruby-node">&quot;Orphaned nodes or endless loops in the tree containing record ##{self.id}&quot;</span>
731:             <span class="ruby-keyword kw">end</span>
732:           <span class="ruby-keyword kw">end</span>
733:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">total_nodes</span>
734:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000064" class="method-detail">
        <a name="M000064"></a>

        <div class="method-heading">
          <a href="#M000064" class="method-signature">
          <span class="method-name">check_subtree</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Checks the left/right indexes of one node and all descendants. Throws
ActiveRecord::ActiveRecordError if it finds a problem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000064-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000064-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 708</span>
708:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">check_subtree</span>
709:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
710:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span>
711:             <span class="ruby-identifier">check</span> <span class="ruby-comment cmt"># this method is implemented via #check, so that we don't generate lots of unnecessary nested transactions</span>
712:           <span class="ruby-keyword kw">end</span>
713:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000021" class="method-detail">
        <a name="M000021"></a>

        <div class="method-heading">
          <a href="#M000021" class="method-signature">
          <span class="method-name">child?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deprecated. Returns true if this is a child node
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000021-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000021-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 462</span>
462:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">child?</span>                          
463:           <span class="ruby-identifier">parent_id</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>]
464:           <span class="ruby-operator">!</span>(<span class="ruby-identifier">parent_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>])
465:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000045" class="method-detail">
        <a name="M000045"></a>

        <div class="method-heading">
          <a href="#M000045" class="method-signature">
          <span class="method-name">child_by_id</span><span class="method-args">(id, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the child for the requested id within the scope of its <a
href="InstanceMethods.html#M000053">children</a>, otherwise nil
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000045-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000045-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 588</span>
588:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">child_by_id</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">scope</span> = {})
589:           <span class="ruby-identifier">children_by_id</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">scope</span>).<span class="ruby-identifier">first</span>
590:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000049" class="method-detail">
        <a name="M000049"></a>

        <div class="method-heading">
          <a href="#M000049" class="method-signature">
          <span class="method-name">child_of?</span><span class="method-args">(parent, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tests wether self is within scope of <a
href="InstanceMethods.html#M000025">parent</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000049-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000049-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 616</span>
616:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">child_of?</span>(<span class="ruby-identifier">parent</span>, <span class="ruby-identifier">scope</span> = {})
617:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scope</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:child_by_id</span>)
618:             <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">child_by_id</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">scope</span>).<span class="ruby-identifier">is_a?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>)
619:           <span class="ruby-keyword kw">else</span>
620:             <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">left_col_name</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">parent</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">parent</span>[<span class="ruby-identifier">right_col_name</span>]
621:           <span class="ruby-keyword kw">end</span>
622:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000053" class="method-detail">
        <a name="M000053"></a>

        <div class="method-heading">
          <a href="#M000053" class="method-signature">
          <span class="method-name">children</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns this record&#8216;s immediate <a
href="InstanceMethods.html#M000053">children</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000053-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000053-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 644</span>
644:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children</span>(<span class="ruby-identifier">scope</span> = {})
645:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND #{prefixed_parent_col_name} = #{self.id}&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
646:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000054" class="method-detail">
        <a name="M000054"></a>

        <div class="method-heading">
          <a href="#M000054" class="method-signature">
          <span class="method-name">children?</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000054-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000054-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 648</span>
648:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children?</span>(<span class="ruby-identifier">scope</span> = {})
649:           <span class="ruby-identifier">children_count</span>(<span class="ruby-identifier">scope</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
650:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000046" class="method-detail">
        <a name="M000046"></a>

        <div class="method-heading">
          <a href="#M000046" class="method-signature">
          <span class="method-name">children_by_id</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a child collection for the requested ids within the scope of its <a
href="InstanceMethods.html#M000053">children</a>, otherwise empty array
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000046-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000046-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 593</span>
593:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_by_id</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
594:           <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> {}
595:           <span class="ruby-identifier">ids</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
596:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { 
597:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;#{scope_condition} AND (#{prefixed_left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]}) AND #{self.class.table_name}.#{self.class.primary_key} IN (?)&quot;</span>, <span class="ruby-identifier">ids</span>] 
598:           }, <span class="ruby-identifier">scope</span>)
599:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000052" class="method-detail">
        <a name="M000052"></a>

        <div class="method-heading">
          <a href="#M000052" class="method-signature">
          <span class="method-name">children_count</span><span class="method-args">(scope= {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000052-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000052-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 639</span>
639:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">children_count</span>(<span class="ruby-identifier">scope</span>= {})
640:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">count_in_nested_set</span>({ <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND #{prefixed_parent_col_name} = #{self.id}&quot;</span> }, <span class="ruby-identifier">scope</span>)
641:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000018" class="method-detail">
        <a name="M000018"></a>

        <div class="method-heading">
          <a href="#M000018" class="method-signature">
          <span class="method-name">destroy_descendants</span><span class="method-args">(</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
On destruction, delete all <a
href="InstanceMethods.html#M000053">children</a> and shift the lft/rgt
values back to the left so the counts still work.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000018-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000018-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 430</span>
430:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">destroy_descendants</span> <span class="ruby-comment cmt"># already protected by a transaction within #destroy</span>
431:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">skip_before_destroy</span>
432:           <span class="ruby-identifier">reloaded</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">reload</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># in case a concurrent move has altered the indexes - rescue if non-existent</span>
433:           <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">reloaded</span>
434:           <span class="ruby-identifier">dif</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
435:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">acts_as_nested_set_options</span>[<span class="ruby-identifier">:dependent</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:delete_all</span>
436:             <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">delete_all</span>( <span class="ruby-node">&quot;#{scope_condition} AND (#{prefixed_left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]})&quot;</span> )          
437:           <span class="ruby-keyword kw">else</span> 
438:             <span class="ruby-identifier">set</span> = <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{prefixed_left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]})&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_right_col_name} DESC&quot;</span>)     
439:             <span class="ruby-identifier">set</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">child</span><span class="ruby-operator">|</span> <span class="ruby-identifier">child</span>.<span class="ruby-identifier">skip_before_destroy</span> = <span class="ruby-keyword kw">true</span>; <span class="ruby-identifier">remove_descendant</span>(<span class="ruby-identifier">child</span>) } 
440:           <span class="ruby-keyword kw">end</span>
441:           <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{left_col_name} = CASE \
442:                                       WHEN #{left_col_name} &gt; #{self[right_col_name]} THEN (#{left_col_name} - #{dif}) \
443:                                       ELSE #{left_col_name} END, \
444:                                  #{right_col_name} = CASE \
445:                                       WHEN #{right_col_name} &gt; #{self[right_col_name]} THEN (#{right_col_name} - #{dif} ) \
446:                                       ELSE #{right_col_name} END&quot;</span>,
447:                                  <span class="ruby-identifier">scope_condition</span>)
448:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000047" class="method-detail">
        <a name="M000047"></a>

        <div class="method-heading">
          <a href="#M000047" class="method-signature">
          <span class="method-name">direct_child_by_id</span><span class="method-args">(id, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the child for the requested id within the scope of its immediate <a
href="InstanceMethods.html#M000053">children</a>, otherwise nil
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000047-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000047-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 602</span>
602:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">direct_child_by_id</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">scope</span> = {})
603:           <span class="ruby-identifier">direct_children_by_id</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">scope</span>).<span class="ruby-identifier">first</span>
604:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000050" class="method-detail">
        <a name="M000050"></a>

        <div class="method-heading">
          <a href="#M000050" class="method-signature">
          <span class="method-name">direct_child_of?</span><span class="method-args">(parent, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tests wether self is within immediate scope of <a
href="InstanceMethods.html#M000025">parent</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000050-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000050-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 625</span>
625:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">direct_child_of?</span>(<span class="ruby-identifier">parent</span>, <span class="ruby-identifier">scope</span> = {})
626:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">scope</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:direct_child_by_id</span>)
627:             <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">direct_child_by_id</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-identifier">scope</span>).<span class="ruby-identifier">is_a?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>)
628:           <span class="ruby-keyword kw">else</span>
629:             <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">parent_col_name</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">parent</span>.<span class="ruby-identifier">id</span>
630:           <span class="ruby-keyword kw">end</span>
631:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000055" class="method-detail">
        <a name="M000055"></a>

        <div class="method-heading">
          <span class="method-name">direct_children</span><span class="method-args">(scope = {})</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="InstanceMethods.html#M000053">children</a>
</p>
        </div>
      </div>

      <div id="method-M000048" class="method-detail">
        <a name="M000048"></a>

        <div class="method-heading">
          <a href="#M000048" class="method-signature">
          <span class="method-name">direct_children_by_id</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a child collection for the requested ids within the scope of its
immediate <a href="InstanceMethods.html#M000053">children</a>, otherwise
empty array
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000048-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000048-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 607</span>
607:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">direct_children_by_id</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
608:           <span class="ruby-identifier">scope</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Hash</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">args</span>.<span class="ruby-identifier">pop</span> <span class="ruby-operator">:</span> {}
609:           <span class="ruby-identifier">ids</span> = <span class="ruby-identifier">args</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
610:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { 
611:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;#{scope_condition} AND #{prefixed_parent_col_name} = #{self.id} AND #{self.class.table_name}.#{self.class.primary_key} IN (?)&quot;</span>, <span class="ruby-identifier">ids</span>]
612:           }, <span class="ruby-identifier">scope</span>)          
613:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000033" class="method-detail">
        <a name="M000033"></a>

        <div class="method-heading">
          <span class="method-name">first?</span><span class="method-args">(scope = {})</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="InstanceMethods.html#M000031">first_sibling</a>?
</p>
        </div>
      </div>

      <div id="method-M000031" class="method-detail">
        <a name="M000031"></a>

        <div class="method-heading">
          <a href="#M000031" class="method-signature">
          <span class="method-name">first_sibling</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns first <a href="InstanceMethods.html#M000028">siblings</a> amongst
it&#8216;s <a href="InstanceMethods.html#M000028">siblings</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000031-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000031-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 517</span>
517:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">first_sibling</span>(<span class="ruby-identifier">scope</span> = {})
518:           <span class="ruby-identifier">self_and_siblings</span>(<span class="ruby-identifier">scope</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name} ASC&quot;</span>)).<span class="ruby-identifier">first</span>
519:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000032" class="method-detail">
        <a name="M000032"></a>

        <div class="method-heading">
          <a href="#M000032" class="method-signature">
          <span class="method-name">first_sibling?</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000032-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000032-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 521</span>
521:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">first_sibling?</span>(<span class="ruby-identifier">scope</span> = {})
522:           <span class="ruby-keyword kw">self</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">first_sibling</span>(<span class="ruby-identifier">scope</span>)
523:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000044" class="method-detail">
        <a name="M000044"></a>

        <div class="method-heading">
          <a href="#M000044" class="method-signature">
          <span class="method-name">full_set</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns itself and all nested <a
href="InstanceMethods.html#M000053">children</a>. Pass :exclude =&gt; item,
or id, or [items or id] to exclude one or more items <b>and</b> all of
their descendants.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000044-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000044-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 575</span>
575:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">full_set</span>(<span class="ruby-identifier">scope</span> = {})
576:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">exclude</span> = <span class="ruby-identifier">scope</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:exclude</span>)
577:             <span class="ruby-identifier">exclude_str</span> = <span class="ruby-node">&quot; AND NOT (#{base_set_class.sql_for(exclude)}) &quot;</span>
578:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">new_record?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">-</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
579:             <span class="ruby-keyword kw">return</span> [<span class="ruby-keyword kw">self</span>]
580:           <span class="ruby-keyword kw">end</span>
581:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { 
582:             <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span>,
583:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} #{exclude_str} AND (#{prefixed_left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]})&quot;</span>
584:           }, <span class="ruby-identifier">scope</span>)
585:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000061" class="method-detail">
        <a name="M000061"></a>

        <div class="method-heading">
          <a href="#M000061" class="method-signature">
          <span class="method-name">full_set_through</span><span class="method-args">(other, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
All <a href="InstanceMethods.html#M000053">children</a> until the other is
reached - including self
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000061-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000061-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 685</span>
685:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">full_set_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span> = {})
686:           <span class="ruby-identifier">first</span>, <span class="ruby-identifier">last</span> = [<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">other</span>].<span class="ruby-identifier">sort</span>
687:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>,  
688:             { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{prefixed_left_col_name} BETWEEN #{first[left_col_name]} AND #{first[right_col_name]}) AND #{prefixed_left_col_name} &lt;= #{last[left_col_name]}&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
689:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000038" class="method-detail">
        <a name="M000038"></a>

        <div class="method-heading">
          <span class="method-name">higher_item</span><span class="method-args">(num = 1, scope = {})</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="InstanceMethods.html#M000037">previous_sibling</a>
</p>
        </div>
      </div>

      <div id="method-M000068" class="method-detail">
        <a name="M000068"></a>

        <div class="method-heading">
          <a href="#M000068" class="method-signature">
          <span class="method-name">insert_at</span><span class="method-args">(target, index = :last, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Insert a node at a specific position among the <a
href="InstanceMethods.html#M000053">children</a> of target.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000068-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000068-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 831</span>
831:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert_at</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">index</span> = <span class="ruby-identifier">:last</span>, <span class="ruby-identifier">scope</span> = {})
832:           <span class="ruby-identifier">level_nodes</span> = <span class="ruby-identifier">target</span>.<span class="ruby-identifier">children</span>(<span class="ruby-identifier">scope</span>)
833:           <span class="ruby-identifier">current_index</span> = <span class="ruby-identifier">level_nodes</span>.<span class="ruby-identifier">index</span>(<span class="ruby-keyword kw">self</span>)
834:           <span class="ruby-identifier">last_index</span> = <span class="ruby-identifier">level_nodes</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span> 
835:           <span class="ruby-identifier">as_first</span> = (<span class="ruby-identifier">index</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:first</span>)
836:           <span class="ruby-identifier">as_last</span>  = (<span class="ruby-identifier">index</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:last</span> <span class="ruby-operator">||</span> (<span class="ruby-identifier">index</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Fixnum</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">last_index</span>))         
837:           <span class="ruby-identifier">index</span> = <span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">as_first</span>
838:           <span class="ruby-identifier">index</span> = <span class="ruby-identifier">last_index</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">as_last</span>
839:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span>
840:             <span class="ruby-identifier">move_to_child_of</span>(<span class="ruby-identifier">target</span>)
841:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">last_index</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">level_nodes</span>[<span class="ruby-identifier">index</span>]            
842:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">as_last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">current_index</span>
843:               <span class="ruby-identifier">move_to_right_of</span>(<span class="ruby-identifier">level_nodes</span>[<span class="ruby-identifier">index</span>])
844:             <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">as_first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">current_index</span>
845:               <span class="ruby-identifier">move_to_left_of</span>(<span class="ruby-identifier">level_nodes</span>[<span class="ruby-identifier">index</span>])
846:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_index</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">current_index</span>
847:               <span class="ruby-identifier">move_to_right_of</span>(<span class="ruby-identifier">level_nodes</span>[<span class="ruby-identifier">index</span>])
848:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_index</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">current_index</span>
849:               <span class="ruby-identifier">move_to_left_of</span>(<span class="ruby-identifier">level_nodes</span>[<span class="ruby-identifier">index</span>])
850:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">current_index</span>.<span class="ruby-identifier">nil?</span>
851:               <span class="ruby-identifier">move_to_left_of</span>(<span class="ruby-identifier">level_nodes</span>[<span class="ruby-identifier">index</span>])
852:             <span class="ruby-keyword kw">end</span>        
853:           <span class="ruby-keyword kw">end</span>
854:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000036" class="method-detail">
        <a name="M000036"></a>

        <div class="method-heading">
          <span class="method-name">last?</span><span class="method-args">(scope = {})</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="InstanceMethods.html#M000034">last_sibling</a>?
</p>
        </div>
      </div>

      <div id="method-M000034" class="method-detail">
        <a name="M000034"></a>

        <div class="method-heading">
          <a href="#M000034" class="method-signature">
          <span class="method-name">last_sibling</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns last <a href="InstanceMethods.html#M000028">siblings</a> amongst
it&#8216;s <a href="InstanceMethods.html#M000028">siblings</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000034-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000034-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 527</span>
527:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">last_sibling</span>(<span class="ruby-identifier">scope</span> = {})
528:           <span class="ruby-identifier">self_and_siblings</span>(<span class="ruby-identifier">scope</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">:limit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name} DESC&quot;</span>)).<span class="ruby-identifier">first</span>
529:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000035" class="method-detail">
        <a name="M000035"></a>

        <div class="method-heading">
          <a href="#M000035" class="method-signature">
          <span class="method-name">last_sibling?</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000035-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000035-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 531</span>
531:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">last_sibling?</span>(<span class="ruby-identifier">scope</span> = {})
532:           <span class="ruby-keyword kw">self</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">last_sibling</span>(<span class="ruby-identifier">scope</span>)
533:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000056" class="method-detail">
        <a name="M000056"></a>

        <div class="method-heading">
          <a href="#M000056" class="method-signature">
          <span class="method-name">leaves</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns this record&#8216;s terminal <a
href="InstanceMethods.html#M000053">children</a> (nodes without <a
href="InstanceMethods.html#M000053">children</a>).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000056-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000056-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 656</span>
656:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">leaves</span>(<span class="ruby-identifier">scope</span> = {})
657:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, 
658:             { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{prefixed_left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]}) AND #{prefixed_left_col_name} + 1 = #{prefixed_right_col_name}&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
659:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000057" class="method-detail">
        <a name="M000057"></a>

        <div class="method-heading">
          <a href="#M000057" class="method-signature">
          <span class="method-name">leaves_count</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the count of this record&#8216;s terminal <a
href="InstanceMethods.html#M000053">children</a> (nodes without <a
href="InstanceMethods.html#M000053">children</a>).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000057-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000057-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 662</span>
662:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">leaves_count</span>(<span class="ruby-identifier">scope</span> = {})
663:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">count_in_nested_set</span>({ <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{prefixed_left_col_name} BETWEEN #{self[left_col_name]} AND #{self[right_col_name]}) AND #{prefixed_left_col_name} + 1 = #{prefixed_right_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
664:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000042" class="method-detail">
        <a name="M000042"></a>

        <div class="method-heading">
          <a href="#M000042" class="method-signature">
          <span class="method-name">level</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="InstanceMethods.html#M000042">level</a> of this object
in the tree, <a href="InstanceMethods.html#M000023">root</a> <a
href="InstanceMethods.html#M000042">level</a> being 0.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000042-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000042-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 562</span>
562:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">level</span>(<span class="ruby-identifier">scope</span> = {})
563:           <span class="ruby-keyword kw">return</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>].<span class="ruby-identifier">nil?</span>
564:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">count_in_nested_set</span>({ <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{self[left_col_name]} BETWEEN #{prefixed_left_col_name} AND #{prefixed_right_col_name})&quot;</span> }, <span class="ruby-identifier">scope</span>) <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
565:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000040" class="method-detail">
        <a name="M000040"></a>

        <div class="method-heading">
          <span class="method-name">lower_item</span><span class="method-args">(num = 1, scope = {})</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="InstanceMethods.html#M000039">next_sibling</a>
</p>
        </div>
      </div>

      <div id="method-M000074" class="method-detail">
        <a name="M000074"></a>

        <div class="method-heading">
          <a href="#M000074" class="method-signature">
          <span class="method-name">move_higher</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Moves a node one down amongst its <a
href="InstanceMethods.html#M000028">siblings</a>. Does nothing if
it&#8216;s already the last sibling.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000074-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000074-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 888</span>
888:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_higher</span>         
889:           <span class="ruby-identifier">prev_sib</span> = <span class="ruby-identifier">previous_sibling</span>
890:           <span class="ruby-identifier">move_to_left_of</span>(<span class="ruby-identifier">prev_sib</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prev_sib</span>
891:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000073" class="method-detail">
        <a name="M000073"></a>

        <div class="method-heading">
          <a href="#M000073" class="method-signature">
          <span class="method-name">move_lower</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Moves a node one up amongst its <a
href="InstanceMethods.html#M000028">siblings</a>. Does nothing if
it&#8216;s already the first sibling.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000073-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000073-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 881</span>
881:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_lower</span>
882:           <span class="ruby-identifier">next_sib</span> = <span class="ruby-identifier">next_sibling</span>
883:           <span class="ruby-identifier">move_to_right_of</span>(<span class="ruby-identifier">next_sib</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">next_sib</span>
884:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000076" class="method-detail">
        <a name="M000076"></a>

        <div class="method-heading">
          <a href="#M000076" class="method-signature">
          <span class="method-name">move_to_bottom</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Moves a node one to be the last amongst its <a
href="InstanceMethods.html#M000028">siblings</a>. Does nothing if
it&#8216;s already the last sibling.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000076-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000076-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 902</span>
902:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_bottom</span>
903:           <span class="ruby-identifier">last_sib</span> = <span class="ruby-identifier">last_sibling</span>
904:           <span class="ruby-identifier">move_to_right_of</span>(<span class="ruby-identifier">last_sib</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last_sib</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">last_sib</span>
905:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000071" class="method-detail">
        <a name="M000071"></a>

        <div class="method-heading">
          <a href="#M000071" class="method-signature">
          <span class="method-name">move_to_child_of</span><span class="method-args">(target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Make this node a child of <em>target</em> (you can pass an object or just
an id). Unsaved changes in either object will be lost. Raises
ActiveRecord::ActiveRecordError if it encounters a problem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000071-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000071-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 870</span>
870:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_child_of</span>(<span class="ruby-identifier">target</span>)
871:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">move_to</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">:child</span>
872:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000069" class="method-detail">
        <a name="M000069"></a>

        <div class="method-heading">
          <a href="#M000069" class="method-signature">
          <span class="method-name">move_to_left_of</span><span class="method-args">(target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Move this node to the left of <em>target</em> (you can pass an object or
just an id). Unsaved changes in either object will be lost. Raises
ActiveRecord::ActiveRecordError if it encounters a problem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000069-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000069-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 858</span>
858:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_left_of</span>(<span class="ruby-identifier">target</span>)
859:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">move_to</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">:left</span>
860:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000072" class="method-detail">
        <a name="M000072"></a>

        <div class="method-heading">
          <a href="#M000072" class="method-signature">
          <span class="method-name">move_to_position</span><span class="method-args">(index, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Moves a node to a certain position amongst its <a
href="InstanceMethods.html#M000028">siblings</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000072-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000072-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 875</span>
875:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_position</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">scope</span> = {})
876:           <span class="ruby-identifier">insert_at</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">parent</span>, <span class="ruby-identifier">index</span>, <span class="ruby-identifier">scope</span>)
877:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000070" class="method-detail">
        <a name="M000070"></a>

        <div class="method-heading">
          <a href="#M000070" class="method-signature">
          <span class="method-name">move_to_right_of</span><span class="method-args">(target)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Move this node to the right of <em>target</em> (you can pass an object or
just an id). Unsaved changes in either object will be lost. Raises
ActiveRecord::ActiveRecordError if it encounters a problem.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000070-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000070-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 864</span>
864:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_right_of</span>(<span class="ruby-identifier">target</span>)
865:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">move_to</span> <span class="ruby-identifier">target</span>, <span class="ruby-identifier">:right</span>
866:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000075" class="method-detail">
        <a name="M000075"></a>

        <div class="method-heading">
          <a href="#M000075" class="method-signature">
          <span class="method-name">move_to_top</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Moves a node one to be the first amongst its <a
href="InstanceMethods.html#M000028">siblings</a>. Does nothing if
it&#8216;s already the first sibling.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000075-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000075-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 895</span>
895:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">move_to_top</span>
896:           <span class="ruby-identifier">first_sib</span> = <span class="ruby-identifier">first_sibling</span>
897:           <span class="ruby-identifier">move_to_left_of</span>(<span class="ruby-identifier">first_sib</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">first_sib</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">first_sib</span>
898:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000039" class="method-detail">
        <a name="M000039"></a>

        <div class="method-heading">
          <a href="#M000039" class="method-signature">
          <span class="method-name">next_sibling</span><span class="method-args">(num = 1, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns next sibling of node or nil if there is none.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000039-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000039-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 545</span>
545:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_sibling</span>(<span class="ruby-identifier">num</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">scope</span> = {})
546:           <span class="ruby-identifier">scope</span>[<span class="ruby-identifier">:limit</span>] = <span class="ruby-identifier">num</span>
547:           <span class="ruby-identifier">siblings</span> = <span class="ruby-identifier">next_siblings</span>(<span class="ruby-identifier">scope</span>)
548:           <span class="ruby-identifier">num</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">siblings</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">siblings</span>
549:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000030" class="method-detail">
        <a name="M000030"></a>

        <div class="method-heading">
          <a href="#M000030" class="method-signature">
          <span class="method-name">next_siblings</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all <a href="InstanceMethods.html#M000028">siblings</a> to the
right of self, in ascending order, so the first sibling is the one closest
to the right of self
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000030-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000030-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 511</span>
511:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_siblings</span>(<span class="ruby-identifier">scope</span> = {})
512:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, 
513:             { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;#{scope_condition} AND #{sibling_condition} AND #{self.class.table_name}.id != ? AND #{prefixed_left_col_name} &gt; ?&quot;</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>]], <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name} ASC&quot;</span>}, <span class="ruby-identifier">scope</span>)
514:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000025" class="method-detail">
        <a name="M000025"></a>

        <div class="method-heading">
          <a href="#M000025" class="method-signature">
          <span class="method-name">parent</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns this record&#8216;s <a
href="InstanceMethods.html#M000025">parent</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000025-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000025-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 485</span>
485:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">parent</span>
486:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>]) <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>]
487:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000037" class="method-detail">
        <a name="M000037"></a>

        <div class="method-heading">
          <a href="#M000037" class="method-signature">
          <span class="method-name">previous_sibling</span><span class="method-args">(num = 1, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns previous sibling of node or nil if there is none.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000037-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000037-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 537</span>
537:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">previous_sibling</span>(<span class="ruby-identifier">num</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">scope</span> = {})
538:           <span class="ruby-identifier">scope</span>[<span class="ruby-identifier">:limit</span>] = <span class="ruby-identifier">num</span>
539:           <span class="ruby-identifier">siblings</span> = <span class="ruby-identifier">previous_siblings</span>(<span class="ruby-identifier">scope</span>)
540:           <span class="ruby-identifier">num</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">siblings</span>.<span class="ruby-identifier">first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">siblings</span>
541:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000029" class="method-detail">
        <a name="M000029"></a>

        <div class="method-heading">
          <a href="#M000029" class="method-signature">
          <span class="method-name">previous_siblings</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all <a href="InstanceMethods.html#M000028">siblings</a> to the left
of self, in descending order, so the first sibling is the one closest to
the left of self
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000029-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000029-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 505</span>
505:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">previous_siblings</span>(<span class="ruby-identifier">scope</span> = {})
506:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, 
507:             { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;#{scope_condition} AND #{sibling_condition} AND #{self.class.table_name}.id != ? AND #{prefixed_right_col_name} &lt; ?&quot;</span>, <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">id</span>, <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>]], <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name} DESC&quot;</span> }, <span class="ruby-identifier">scope</span>)
508:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000066" class="method-detail">
        <a name="M000066"></a>

        <div class="method-heading">
          <a href="#M000066" class="method-signature">
          <span class="method-name">renumber_full_tree</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Re-calculate the left/right values of all nodes in this record&#8216;s
tree. Can be used to convert an ordinary tree into a nested set.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000066-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000066-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 737</span>
737:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">renumber_full_tree</span>
738:           <span class="ruby-identifier">indexes</span> = []
739:           <span class="ruby-identifier">n</span> = <span class="ruby-value">1</span>
740:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
741:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">roots</span> <span class="ruby-comment cmt"># because we may have virtual roots</span>
742:               <span class="ruby-identifier">n</span> = <span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">calc_numbers</span>(<span class="ruby-identifier">n</span>, <span class="ruby-identifier">indexes</span>)
743:             <span class="ruby-keyword kw">end</span>
744:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">i</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">indexes</span>
745:               <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-node">&quot;#{left_col_name} = #{i[:lft]}, #{right_col_name} = #{i[:rgt]}&quot;</span>, <span class="ruby-node">&quot;#{self.class.primary_key} = #{i[:id]}&quot;</span>)
746:             <span class="ruby-keyword kw">end</span>
747:           <span class="ruby-keyword kw">end</span>
748:           <span class="ruby-comment cmt">## reload?</span>
749:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000078" class="method-detail">
        <a name="M000078"></a>

        <div class="method-heading">
          <a href="#M000078" class="method-signature">
          <span class="method-name">reorder_children</span><span class="method-args">(*ids)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Reorder <a href="InstanceMethods.html#M000053">children</a> according to an
array of ids
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000078-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000078-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 914</span>
914:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reorder_children</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">ids</span>)
915:           <span class="ruby-identifier">transaction</span> <span class="ruby-keyword kw">do</span>
916:             <span class="ruby-identifier">ordered_ids</span> = <span class="ruby-identifier">ids</span>.<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">uniq</span>
917:             <span class="ruby-identifier">current_children</span> = <span class="ruby-identifier">children</span>({ <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> { <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ordered_ids</span> } })
918:             <span class="ruby-identifier">current_children_ids</span> = <span class="ruby-identifier">current_children</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:id</span>)
919:             <span class="ruby-identifier">ordered_ids</span> = <span class="ruby-identifier">ordered_ids</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">current_children_ids</span>
920:             <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ordered_ids</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ordered_ids</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">current_children_ids</span>
921:             <span class="ruby-identifier">perform_reorder_of_children</span>(<span class="ruby-identifier">ordered_ids</span>, <span class="ruby-identifier">current_children</span>)
922:           <span class="ruby-keyword kw">end</span>         
923:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000023" class="method-detail">
        <a name="M000023"></a>

        <div class="method-heading">
          <a href="#M000023" class="method-signature">
          <span class="method-name">root</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns this record&#8216;s <a href="InstanceMethods.html#M000023">root</a>
ancestor.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000023-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000023-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 473</span>
473:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root</span>(<span class="ruby-identifier">scope</span> = {})
474:           <span class="ruby-comment cmt"># the BETWEEN clause is needed to ensure we get the right virtual root, if using those</span>
475:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:first</span>, { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} \
476:             AND (#{prefixed_parent_col_name} IS NULL OR #{prefixed_parent_col_name} = 0) AND (#{self[left_col_name]} BETWEEN #{prefixed_left_col_name} AND #{prefixed_right_col_name})&quot;</span> }, <span class="ruby-identifier">scope</span>)
477:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000020" class="method-detail">
        <a name="M000020"></a>

        <div class="method-heading">
          <a href="#M000020" class="method-signature">
          <span class="method-name">root?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deprecated. Returns true if this is a <a
href="InstanceMethods.html#M000023">root</a> node.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000020-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000020-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 456</span>
456:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">root?</span>
457:           <span class="ruby-identifier">parent_id</span> = <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>]
458:           (<span class="ruby-identifier">parent_id</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">parent_id</span>.<span class="ruby-identifier">nil?</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>])
459:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000024" class="method-detail">
        <a name="M000024"></a>

        <div class="method-heading">
          <a href="#M000024" class="method-signature">
          <span class="method-name">roots</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the <a href="InstanceMethods.html#M000023">root</a> or virtual <a
href="InstanceMethods.html#M000024">roots</a> of this record&#8216;s tree
(a tree cannot have more than one real <a
href="InstanceMethods.html#M000023">root</a>). See the explanation of
virtual <a href="InstanceMethods.html#M000024">roots</a> in the README.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000024-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000024-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 480</span>
480:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">roots</span>(<span class="ruby-identifier">scope</span> = {})
481:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{prefixed_parent_col_name} IS NULL OR #{prefixed_parent_col_name} = 0)&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
482:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000027" class="method-detail">
        <a name="M000027"></a>

        <div class="method-heading">
          <a href="#M000027" class="method-signature">
          <span class="method-name">self_and_ancestors</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of all parents plus self, starting with the <a
href="InstanceMethods.html#M000023">root</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000027-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000027-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 495</span>
495:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">self_and_ancestors</span>(<span class="ruby-identifier">scope</span> = {})
496:           <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND (#{self[left_col_name]} BETWEEN #{prefixed_left_col_name} AND #{prefixed_right_col_name})&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
497:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000041" class="method-detail">
        <a name="M000041"></a>

        <div class="method-heading">
          <a href="#M000041" class="method-signature">
          <span class="method-name">self_and_siblings</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all the <a href="InstanceMethods.html#M000053">children</a> of this
node&#8216;s <a href="InstanceMethods.html#M000025">parent</a>, including
self.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000041-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000041-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 553</span>
553:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">self_and_siblings</span>(<span class="ruby-identifier">scope</span> = {})
554:           <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>].<span class="ruby-identifier">zero?</span>
555:             [<span class="ruby-keyword kw">self</span>]
556:           <span class="ruby-keyword kw">else</span>
557:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND #{sibling_condition}&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
558:           <span class="ruby-keyword kw">end</span>
559:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000062" class="method-detail">
        <a name="M000062"></a>

        <div class="method-heading">
          <a href="#M000062" class="method-signature">
          <span class="method-name">self_and_siblings_through</span><span class="method-args">(other, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
All <a href="InstanceMethods.html#M000028">siblings</a> until the other is
reached - including self
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000062-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000062-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 692</span>
692:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">self_and_siblings_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span> = {})
693:           <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>].<span class="ruby-identifier">zero?</span>
694:             [<span class="ruby-keyword kw">self</span>]
695:           <span class="ruby-keyword kw">else</span>
696:             <span class="ruby-identifier">first</span>, <span class="ruby-identifier">last</span> = [<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">other</span>].<span class="ruby-identifier">sort</span>
697:             <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">find_in_nested_set</span>(<span class="ruby-identifier">:all</span>, { <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{scope_condition} AND #{sibling_condition} AND (#{prefixed_left_col_name} BETWEEN #{first[left_col_name]} AND #{last[right_col_name]})&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;#{prefixed_left_col_name}&quot;</span> }, <span class="ruby-identifier">scope</span>)
698:           <span class="ruby-keyword kw">end</span>
699:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000017" class="method-detail">
        <a name="M000017"></a>

        <div class="method-heading">
          <a href="#M000017" class="method-signature">
          <span class="method-name">set_left_right</span><span class="method-args">(</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
On creation, automatically add the new node to the right of all existing
nodes in this tree.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000017-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000017-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 423</span>
423:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_left_right</span> <span class="ruby-comment cmt"># already protected by a transaction within #create</span>
424:           <span class="ruby-identifier">maxright</span> = <span class="ruby-identifier">base_set_class</span>.<span class="ruby-identifier">maximum</span>(<span class="ruby-identifier">right_col_name</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">scope_condition</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
425:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">left_col_name</span>] = <span class="ruby-identifier">maxright</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
426:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">right_col_name</span>] = <span class="ruby-identifier">maxright</span><span class="ruby-operator">+</span><span class="ruby-value">2</span>
427:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000016" class="method-detail">
        <a name="M000016"></a>

        <div class="method-heading">
          <a href="#M000016" class="method-signature">
          <span class="method-name">sibling_condition</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This takes care of valid queries when called on a <a
href="InstanceMethods.html#M000023">root</a> node
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000016-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000016-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 418</span>
418:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sibling_condition</span>
419:           <span class="ruby-keyword kw">self</span>[<span class="ruby-identifier">parent_col_name</span>] <span class="ruby-operator">?</span> <span class="ruby-node">&quot;#{prefixed_parent_col_name} = #{self[parent_col_name]}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;(#{prefixed_parent_col_name} IS NULL OR #{prefixed_parent_col_name} = 0)&quot;</span>
420:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000028" class="method-detail">
        <a name="M000028"></a>

        <div class="method-heading">
          <a href="#M000028" class="method-signature">
          <span class="method-name">siblings</span><span class="method-args">(scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns all the <a href="InstanceMethods.html#M000053">children</a> of this
node&#8216;s <a href="InstanceMethods.html#M000025">parent</a>, except
self.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000028-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000028-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 500</span>
500:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">siblings</span>(<span class="ruby-identifier">scope</span> = {})
501:           <span class="ruby-identifier">self_and_siblings</span>(<span class="ruby-identifier">scope</span>) <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
502:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000063" class="method-detail">
        <a name="M000063"></a>

        <div class="method-heading">
          <a href="#M000063" class="method-signature">
          <span class="method-name">siblings_through</span><span class="method-args">(other, scope = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
All <a href="InstanceMethods.html#M000028">siblings</a> until the other is
reached - excluding self
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000063-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000063-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 702</span>
702:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">siblings_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span> = {})
703:           <span class="ruby-identifier">self_and_siblings_through</span>(<span class="ruby-identifier">other</span>, <span class="ruby-identifier">scope</span>) <span class="ruby-operator">-</span> [<span class="ruby-keyword kw">self</span>]
704:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000077" class="method-detail">
        <a name="M000077"></a>

        <div class="method-heading">
          <a href="#M000077" class="method-signature">
          <span class="method-name">swap</span><span class="method-args">(target, transact = true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Swaps the position of two sibling nodes preserving a sibling&#8216;s
descendants. The current implementation only works amongst <a
href="InstanceMethods.html#M000028">siblings</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000077-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000077-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 909</span>
909:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">swap</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">transact</span> = <span class="ruby-keyword kw">true</span>)
910:           <span class="ruby-identifier">move_to</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">:swap</span>, <span class="ruby-identifier">transact</span>)     
911:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000022" class="method-detail">
        <a name="M000022"></a>

        <div class="method-heading">
          <a href="#M000022" class="method-signature">
          <span class="method-name">unknown?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deprecated. Returns true if we have no idea what this is
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000022-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000022-source">
<pre>
     <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 468</span>
468:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">unknown?</span>
469:           <span class="ruby-operator">!</span><span class="ruby-identifier">root?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">child?</span>
470:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Protected Instance methods</h3>

      <div id="method-M000080" class="method-detail">
        <a name="M000080"></a>

        <div class="method-heading">
          <a href="#M000080" class="method-signature">
          <span class="method-name">calculate_reorder_steps</span><span class="method-args">(ordered_ids, current)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Calculate the least amount of <a
href="InstanceMethods.html#M000077">swap</a> steps to achieve the requested
order
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000080-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000080-source">
<pre>
      <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 1080</span>
1080:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">calculate_reorder_steps</span>(<span class="ruby-identifier">ordered_ids</span>, <span class="ruby-identifier">current</span>)
1081:           <span class="ruby-identifier">steps</span> = []
1082:           <span class="ruby-identifier">current</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">source</span>, <span class="ruby-identifier">idx</span><span class="ruby-operator">|</span>
1083:             <span class="ruby-identifier">new_idx</span> = <span class="ruby-identifier">ordered_ids</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">source</span>.<span class="ruby-identifier">id</span>)
1084:             <span class="ruby-identifier">steps</span> <span class="ruby-operator">&lt;&lt;</span> [<span class="ruby-identifier">source</span>, <span class="ruby-identifier">new_idx</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">idx</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">new_idx</span>
1085:           <span class="ruby-keyword kw">end</span>
1086:           <span class="ruby-identifier">steps</span>
1087:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000079" class="method-detail">
        <a name="M000079"></a>

        <div class="method-heading">
          <a href="#M000079" class="method-signature">
          <span class="method-name">perform_reorder_of_children</span><span class="method-args">(ordered_ids, current)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Actually perform the ordering using calculated steps
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000079-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000079-source">
<pre>
      <span class="ruby-comment cmt"># File lib/better_nested_set.rb, line 1065</span>
1065:         <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">perform_reorder_of_children</span>(<span class="ruby-identifier">ordered_ids</span>, <span class="ruby-identifier">current</span>)
1066:           <span class="ruby-identifier">steps</span> = <span class="ruby-identifier">calculate_reorder_steps</span>(<span class="ruby-identifier">ordered_ids</span>, <span class="ruby-identifier">current</span>)
1067:           <span class="ruby-identifier">steps</span>.<span class="ruby-identifier">inject</span>([]) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">result</span>, (<span class="ruby-identifier">source</span>, <span class="ruby-identifier">idx</span>)<span class="ruby-operator">|</span>
1068:             <span class="ruby-identifier">target</span> = <span class="ruby-identifier">current</span>[<span class="ruby-identifier">idx</span>]
1069:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">source</span>.<span class="ruby-identifier">id</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">target</span>.<span class="ruby-identifier">id</span>            
1070:               <span class="ruby-identifier">source</span>.<span class="ruby-identifier">swap</span>(<span class="ruby-identifier">target</span>, <span class="ruby-keyword kw">false</span>)             
1071:               <span class="ruby-identifier">from</span> = <span class="ruby-identifier">current</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">source</span>)
1072:               <span class="ruby-identifier">current</span>[<span class="ruby-identifier">from</span>], <span class="ruby-identifier">current</span>[<span class="ruby-identifier">idx</span>] = <span class="ruby-identifier">current</span>[<span class="ruby-identifier">idx</span>], <span class="ruby-identifier">current</span>[<span class="ruby-identifier">from</span>]
1073:               <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">source</span>
1074:             <span class="ruby-keyword kw">end</span>
1075:             <span class="ruby-identifier">result</span>
1076:           <span class="ruby-keyword kw">end</span>
1077:         <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>